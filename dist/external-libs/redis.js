"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _ioredis = _interopRequireDefault(require("ioredis"));

_ioredis.default.Promise = global.Promise;
var redis = new _ioredis.default({
  host: process.env.REDIS_DEFAULT_HOST,
  port: process.env.REDIS_DEFAULT_PORT,
  db: process.env.REDIS_DEFAULT_DB,
  retry_strategy: function retry_strategy(options) {
    return Math.max(options.attempt * 100, 3000);
  },
  reconnectOnError: function reconnectOnError(err) {
    var targetError = "READONLY";

    if (err.message.slice(0, targetError.length) === targetError) {
      // Only reconnect when the error starts with "READONLY"
      return true; // or `return 1;`
    }
  }
});
var _default = redis;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leHRlcm5hbC1saWJzL3JlZGlzLmpzIl0sIm5hbWVzIjpbIlJlZGlzIiwiUHJvbWlzZSIsImdsb2JhbCIsInJlZGlzIiwiaG9zdCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19ERUZBVUxUX0hPU1QiLCJwb3J0IiwiUkVESVNfREVGQVVMVF9QT1JUIiwiZGIiLCJSRURJU19ERUZBVUxUX0RCIiwicmV0cnlfc3RyYXRlZ3kiLCJvcHRpb25zIiwiTWF0aCIsIm1heCIsImF0dGVtcHQiLCJyZWNvbm5lY3RPbkVycm9yIiwiZXJyIiwidGFyZ2V0RXJyb3IiLCJtZXNzYWdlIiwic2xpY2UiLCJsZW5ndGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUVBQSxpQkFBTUMsT0FBTixHQUFnQkMsTUFBTSxDQUFDRCxPQUF2QjtBQUVBLElBQU1FLEtBQUssR0FBRyxJQUFJSCxnQkFBSixDQUFVO0FBQ3RCSSxFQUFBQSxJQUFJLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxrQkFESTtBQUV0QkMsRUFBQUEsSUFBSSxFQUFFSCxPQUFPLENBQUNDLEdBQVIsQ0FBWUcsa0JBRkk7QUFHdEJDLEVBQUFBLEVBQUUsRUFBRUwsT0FBTyxDQUFDQyxHQUFSLENBQVlLLGdCQUhNO0FBSXRCQyxFQUFBQSxjQUFjLEVBQUUsd0JBQUFDLE9BQU8sRUFBSTtBQUN6QixXQUFPQyxJQUFJLENBQUNDLEdBQUwsQ0FBU0YsT0FBTyxDQUFDRyxPQUFSLEdBQWtCLEdBQTNCLEVBQWdDLElBQWhDLENBQVA7QUFDRCxHQU5xQjtBQU90QkMsRUFBQUEsZ0JBQWdCLEVBQUUsMEJBQUFDLEdBQUcsRUFBSTtBQUN2QixRQUFNQyxXQUFXLEdBQUcsVUFBcEI7O0FBQ0EsUUFBSUQsR0FBRyxDQUFDRSxPQUFKLENBQVlDLEtBQVosQ0FBa0IsQ0FBbEIsRUFBcUJGLFdBQVcsQ0FBQ0csTUFBakMsTUFBNkNILFdBQWpELEVBQThEO0FBQzVEO0FBQ0EsYUFBTyxJQUFQLENBRjRELENBRS9DO0FBQ2Q7QUFDRjtBQWJxQixDQUFWLENBQWQ7ZUFnQmVoQixLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlZGlzIGZyb20gXCJpb3JlZGlzXCI7XG5cblJlZGlzLlByb21pc2UgPSBnbG9iYWwuUHJvbWlzZTtcblxuY29uc3QgcmVkaXMgPSBuZXcgUmVkaXMoe1xuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19ERUZBVUxUX0hPU1QsXG4gIHBvcnQ6IHByb2Nlc3MuZW52LlJFRElTX0RFRkFVTFRfUE9SVCxcbiAgZGI6IHByb2Nlc3MuZW52LlJFRElTX0RFRkFVTFRfREIsXG4gIHJldHJ5X3N0cmF0ZWd5OiBvcHRpb25zID0+IHtcbiAgICByZXR1cm4gTWF0aC5tYXgob3B0aW9ucy5hdHRlbXB0ICogMTAwLCAzMDAwKTtcbiAgfSxcbiAgcmVjb25uZWN0T25FcnJvcjogZXJyID0+IHtcbiAgICBjb25zdCB0YXJnZXRFcnJvciA9IFwiUkVBRE9OTFlcIjtcbiAgICBpZiAoZXJyLm1lc3NhZ2Uuc2xpY2UoMCwgdGFyZ2V0RXJyb3IubGVuZ3RoKSA9PT0gdGFyZ2V0RXJyb3IpIHtcbiAgICAgIC8vIE9ubHkgcmVjb25uZWN0IHdoZW4gdGhlIGVycm9yIHN0YXJ0cyB3aXRoIFwiUkVBRE9OTFlcIlxuICAgICAgcmV0dXJuIHRydWU7IC8vIG9yIGByZXR1cm4gMTtgXG4gICAgfVxuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcmVkaXM7XG4iXX0=